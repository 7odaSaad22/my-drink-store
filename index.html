<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div id="loginSection" class="auth-container">
        <div class="auth-box">
            <h2>ğŸµ ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„:</label>
                <input type="text" id="customerName" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ">
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="customerPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button onclick="customerLogin()" class="auth-btn">Ø¯Ø®ÙˆÙ„</button><admin.html></admin.html>
            <p style="color: #999; font-size: 12px; margin-top: 10px;">
                Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©: Ø§Ù„Ø§Ø³Ù…: Ø£Ø­Ù…Ø¯ | Ø§Ù„Ø±Ù…Ø²: 1234
            </p>
        </div>
    </div>

    <!-- ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div id="orderSection" class="main-container" style="display: none;">
        <header class="customer-header">
            <h1>â˜• Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h1>
            <div class="user-info">
                <span id="userNameDisplay"></span>
                <button onclick="customerLogout()" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div class="container">
            <div class="orders-layout">
                <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div class="products-section">
                    <h2>ğŸ“‹ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h2>
                    <div style="margin-bottom:10px;">
                        <button onclick="addAllProductsToOrder()" class="add-all-btn">Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø·Ù„Ø¨</button>
                    </div>
                    <div class="product-grid" id="productGrid"></div>
                </div>

                <!-- Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ -->
                <div class="order-summary">
                    <h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
                    <div id="orderItems" class="order-items">
                        <p style="color: #999;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø¹Ù†Ø§ØµØ±</p>
                    </div>
                        <div class="order-notes">
                            <label for="orderNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                            <textarea id="orderNotes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..." rows="3" style="width:100%; margin-top:6px;"></textarea>
                        </div>
                    <div class="order-total">
                        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±: <span id="totalPrice">0</span></h3>
                    </div>
                    <button onclick="submitOrder()" class="submit-btn">âœ“ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                    <button onclick="clearOrder()" class="clear-btn">âœ• Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… ØªØªØ¨Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
            <div class="orders-tracking">
                <h2>ğŸ“¦ ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ</h2>
                <div id="ordersHistory" class="orders-history">
                    <p style="color: #999; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        const customers = {
            'Ø£Ø­Ù…Ø¯': { password: '1234', id: 1 },
            'Ù…Ø­Ù…Ø¯': { password: '5678', id: 2 },
            'ÙØ§Ø·Ù…Ø©': { password: '9012', id: 3 }
        };

        let currentOrder = [];

        // Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        const products = [
            'Ø´Ø§ÙŠ',
            'Ø´Ø§ÙŠ Ø§Ø®Ø¶',
            'ÙŠØ§Ù†Ø³ÙˆÙ†',
            'Ù†Ø¹Ù†Ø§Ø¹',
            'ÙƒØ±ÙƒØ¯ÙŠØ©',
            'Ù‚Ø±ÙØ©',
            'Ø¬Ù†Ø²Ø¨ÙŠÙ„',
            'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³',
            'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1',
            'Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1',
            'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1',
            'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ',
            'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚',
            'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§',
            'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡',
            'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª',
            'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ',
            'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ',
            'Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨',
            'Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨'
        ];

        // Ø¨Ù†Ø§Ø¡ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
        function renderProducts() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            products.forEach((name, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `
                    <h3>${name}</h3>
                    <div class="quantity-selector">
                        <button onclick="decreaseQty(${idx})">-</button>
                        <input type="number" id="qty${idx}" value="0" min="0" readonly>
                        <button onclick="increaseQty(${idx})">+</button>
                    </div>
                    <button onclick="addToOrder(${idx}, '${name}')" class="add-btn">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨</button>
                `;
                grid.appendChild(card);
            });
        }

        // Ø¯ÙˆØ§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function customerLogin() {
            const name = document.getElementById('customerName').value.trim();
            const password = document.getElementById('customerPassword').value;

            if (!name || !password) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (customers[name] && customers[name].password === password) {
                localStorage.setItem('currentCustomer', name);
                localStorage.setItem('customerId', customers[name].id);
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('orderSection').style.display = 'block';
                document.getElementById('userNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${name}`;
                loadCustomerOrders();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
                setInterval(loadCustomerOrders, 5000);
            } else {
                alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
            }
        }

        function customerLogout() {
            localStorage.removeItem('currentCustomer');
            localStorage.removeItem('customerId');
            document.getElementById('loginSection').style.display = 'block';
            document.getElementById('orderSection').style.display = 'none';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPassword').value = '';
            currentOrder = [];
        }

        // ØªØ­Ù…ÙŠÙ„ Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
        function loadCustomerOrders() {
            const customerName = localStorage.getItem('currentCustomer');
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const customerOrders = orders.filter(order => order.customerName === customerName);
            const ordersHistory = document.getElementById('ordersHistory');

            if (customerOrders.length === 0) {
                ordersHistory.innerHTML = '<p style="color: #999; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>';
                return;
            }

            let html = '<div class="orders-list">';
            customerOrders.forEach((order) => {
                const items = order.items.map(item => `${item.name} (${item.qty})`).join(', ');
                const statusClass = order.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' ? 'approved' : 'pending';
                const statusText = order.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' ? 'âœ“ Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' : 'â³ Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©';
                
                let recipientInfo = '';
                if (order.adminRecipient) {
                    recipientInfo = `<p style="color: #27ae60; margin: 5px 0;"><strong>Ù…Ø³ØªÙ„Ù… Ø§Ù„Ø£ÙˆØ±Ø¯Ø±:</strong> ${order.adminRecipient}</p>`;
                }

                html += `
                    <div class="order-card ${statusClass}">
                        <div class="order-header">
                            <span><strong>Ø§Ù„Ø·Ù„Ø¨ #${order.id}</strong></span>
                            <span class="order-status ${statusClass}">${statusText}</span>
                        </div>
                        <p><strong>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª:</strong> ${items}</p>
                        ${order.notes ? `<p><strong>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</strong> ${order.notes}</p>` : ''}
                        <p><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®:</strong> ${order.date}</p>
                        ${recipientInfo}
                    </div>
                `;
            });
            html += '</div>';
            ordersHistory.innerHTML = html;
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙƒÙ…ÙŠØ©
        function increaseQty(index) {
            const input = document.getElementById('qty' + index);
            input.value = parseInt(input.value) + 1;
        }

        function decreaseQty(index) {
            const input = document.getElementById('qty' + index);
            if (parseInt(input.value) > 0) {
                input.value = parseInt(input.value) - 1;
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨
        function addToOrder(index, name) {
            const qty = parseInt(document.getElementById('qty' + index).value);
            if (qty === 0) {
                alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ…ÙŠØ©');
                return;
            }

            // ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ø³Ø¬Ù„ ÙÙŠ localStorage
            const inv = JSON.parse(localStorage.getItem('inventory')) || {};
            const available = inv[name] ? parseInt(inv[name].stock) || 0 : Infinity;

            const existingItem = currentOrder.find(item => item.name === name);
            const alreadyInCart = existingItem ? existingItem.qty : 0;

            if (qty + alreadyInCart > available) {
                alert(`Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø© (${qty + alreadyInCart}) ØªØªØ¬Ø§ÙˆØ² Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…ØªØ§Ø­ (${available})`);
                return;
            }

            if (existingItem) {
                existingItem.qty += qty;
            } else {
                currentOrder.push({ name, qty });
            }

            document.getElementById('qty' + index).value = 0;
            updateOrderDisplay();
        }

        // Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¨ÙƒÙ…ÙŠØ© 1 (ØªØ­ØªØ±Ù… Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¥Ø°Ø§ ÙˆÙØ¬Ø¯)
        function addAllProductsToOrder() {
            const inv = JSON.parse(localStorage.getItem('inventory')) || {};
            let skipped = 0;
            products.forEach((name, idx) => {
                const available = inv[name] ? parseInt(inv[name].stock) || 0 : Infinity;
                if (available === 0) {
                    skipped++;
                    return;
                }

                const existing = currentOrder.find(item => item.name === name);
                if (existing) {
                    if (existing.qty + 1 <= available) {
                        existing.qty += 1;
                    }
                } else {
                    currentOrder.push({ name, qty: 1 });
                }

                const el = document.getElementById('qty' + idx);
                if (el) el.value = 0;
            });
            updateOrderDisplay();
            if (skipped > 0) alert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…ØªØ§Ø­Ø©. ${skipped} Ù…Ù†ØªØ¬/Ù…Ù†ØªØ¬Ø§Øª Ù„Ù… ØªÙØ¶Ù Ù„Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø®Ø²ÙˆÙ†.`);
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨
        function updateOrderDisplay() {
            const orderItemsDiv = document.getElementById('orderItems');
            let total = 0;

            if (currentOrder.length === 0) {
                orderItemsDiv.innerHTML = '<p style="color: #999;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø¹Ù†Ø§ØµØ±</p>';
                document.getElementById('totalPrice').textContent = '0';
                return;
            }

            let html = '<ul style="list-style: none; padding: 0;">';
            currentOrder.forEach((item, idx) => {
                total += item.qty;
                html += `
                    <li class="order-item">
                        <span>${item.name} (${item.qty}x)</span>
                        <button onclick="removeFromOrder(${idx})" class="remove-btn">âœ•</button>
                    </li>
                `;
            });
            html += '</ul>';

            orderItemsDiv.innerHTML = html;
            document.getElementById('totalPrice').textContent = total;
        }

        // Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø·Ù„Ø¨
        function removeFromOrder(index) {
            currentOrder.splice(index, 1);
            updateOrderDisplay();
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨
        function clearOrder() {
            currentOrder = [];
                for (let i = 0; i < products.length; i++) {
                    const el = document.getElementById('qty' + i);
                    if (el) el.value = 0;
                }
            const notesEl = document.getElementById('orderNotes');
            if (notesEl) notesEl.value = '';
            updateOrderDisplay();
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨
        function submitOrder() {
            if (currentOrder.length === 0) {
                alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ÙˆØ§Ø­Ø¯ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„');
                return;
            }

            const customerName = localStorage.getItem('currentCustomer');
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const notes = (document.getElementById('orderNotes') || { value: '' }).value.trim();

            const newOrder = {
                id: Date.now(),
                customerName,
                items: currentOrder,
                date: new Date().toLocaleString('ar-EG'),
                status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                notes: notes
            };

            orders.push(newOrder);
            localStorage.setItem('orders', JSON.stringify(orders));

            alert('âœ“ ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø³ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯Ù‡ Ù‚Ø±ÙŠØ¨Ø§Ù‹.');
            clearOrder();
            loadCustomerOrders();
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        renderProducts();

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        window.addEventListener('load', function() {
            const customer = localStorage.getItem('currentCustomer');
            if (customer) {
                document.getElementById('loginSection').style.display = 'none';
                document.getElementById('orderSection').style.display = 'block';
                document.getElementById('userNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${customer}`;
                loadCustomerOrders();
                
                // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø·Ù„Ø¨Ø§Øª ÙƒÙ„ 5 Ø«ÙˆØ§Ù†ÙŠ
                setInterval(loadCustomerOrders, 5000);
            }
        });
    </script>
</body>
</html>