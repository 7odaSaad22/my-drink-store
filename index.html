<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="orderSection" class="main-container">
        <header class="customer-header">
            <h1>â˜• Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h1>
            <div class="user-info">
                <span id="userNameDisplay"></span>
                <button onclick="customerLogout()" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div class="container">
            <div class="orders-layout">
                <div class="products-section">
                    <h2>ğŸ“‹ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h2>
                    <div style="margin-bottom:10px;">
                        <button onclick="addAllProductsToOrder()" class="add-all-btn">Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø·Ù„Ø¨</button>
                    </div>
                    <div class="product-grid" id="productGrid"></div>
                </div>

                <div class="order-summary">
                    <h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
                    <div id="orderItems" class="order-items">
                        <p style="color: #999;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø¹Ù†Ø§ØµØ±</p>
                    </div>
                    <div class="order-notes">
                        <label for="orderNotes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
                        <textarea id="orderNotes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..." rows="3" style="width:100%; margin-top:6px;"></textarea>
                    </div>
                    <div class="order-total">
                        <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±: <span id="totalPrice">0</span></h3>
                    </div>
                    <button onclick="submitOrder()" class="submit-btn">âœ“ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                    <button onclick="clearOrder()" class="clear-btn">âœ• Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>

            <div class="orders-tracking">
                <h2>ğŸ“¦ ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ</h2>
                <div id="ordersHistory" class="orders-history">
                    <p style="color: #999; text-align: center;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const products = ['Ø´Ø§ÙŠ','Ø´Ø§ÙŠ Ø§Ø®Ø¶','ÙŠØ§Ù†Ø³ÙˆÙ†','Ù†Ø¹Ù†Ø§Ø¹','ÙƒØ±ÙƒØ¯ÙŠØ©','Ù‚Ø±ÙØ©','Ø¬Ù†Ø²Ø¨ÙŠÙ„','ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³','ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1','Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1','Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1','Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ','ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚','ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§','ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡','Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª','Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ','Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ','Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨','Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨'];
        let currentOrder = [];

        window.addEventListener('load', function() {
            const customer = localStorage.getItem('currentCustomer');
            if (!customer) { window.location.href = "login.html"; }
            else {
                document.getElementById('userNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${customer}`;
                renderProducts();
                loadCustomerOrders();
                setInterval(loadCustomerOrders, 5000);
            }
        });

        function customerLogout() {
            localStorage.clear();
            window.location.href = "login.html";
        }

        function renderProducts() {
            const grid = document.getElementById('productGrid');
            grid.innerHTML = '';
            products.forEach((name, idx) => {
                const card = document.createElement('div');
                card.className = 'card';
                card.innerHTML = `<h3>${name}</h3><div class="quantity-selector"><button onclick="decreaseQty(${idx})">-</button><input type="number" id="qty${idx}" value="0" min="0" readonly><button onclick="increaseQty(${idx})">+</button></div><button onclick="addToOrder(${idx}, '${name}')" class="add-btn">Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø·Ù„Ø¨</button>`;
                grid.appendChild(card);
            });
        }

        function increaseQty(index) { document.getElementById('qty' + index).value++; }
        function decreaseQty(index) { 
            let input = document.getElementById('qty' + index);
            if (input.value > 0) input.value--;
        }

        function addToOrder(index, name) {
            const qty = parseInt(document.getElementById('qty' + index).value);
            if (qty === 0) return alert('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒÙ…ÙŠØ©');
            const existing = currentOrder.find(item => item.name === name);
            if (existing) existing.qty += qty; else currentOrder.push({ name, qty });
            document.getElementById('qty' + index).value = 0;
            updateOrderDisplay();
        }

        function updateOrderDisplay() {
            const orderItemsDiv = document.getElementById('orderItems');
            let total = 0;
            if (currentOrder.length === 0) {
                orderItemsDiv.innerHTML = '<p style="color: #999;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø¹Ù†Ø§ØµØ±</p>';
                document.getElementById('totalPrice').textContent = '0';
                return;
            }
            let html = '<ul style="list-style: none; padding: 0;">';
            currentOrder.forEach((item, idx) => {
                total += item.qty;
                html += `<li class="order-item"><span>${item.name} (${item.qty}x)</span><button onclick="removeFromOrder(${idx})" class="remove-btn">âœ•</button></li>`;
            });
            orderItemsDiv.innerHTML = html + '</ul>';
            document.getElementById('totalPrice').textContent = total;
        }

        function removeFromOrder(index) { currentOrder.splice(index, 1); updateOrderDisplay(); }
        function clearOrder() { currentOrder = []; updateOrderDisplay(); }

        function submitOrder() {
            if (currentOrder.length === 0) return alert('Ø£Ø¶Ù Ø¹Ù†ØµØ±Ø§Ù‹ Ø£ÙˆÙ„Ø§Ù‹');
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push({ id: Date.now(), customerName: localStorage.getItem('currentCustomer'), items: currentOrder, date: new Date().toLocaleString('ar-EG'), status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©', notes: document.getElementById('orderNotes').value });
            localStorage.setItem('orders', JSON.stringify(orders));
            alert('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„');
            clearOrder();
            loadCustomerOrders();
        }

        function loadCustomerOrders() {
            const customerName = localStorage.getItem('currentCustomer');
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const customerOrders = orders.filter(o => o.customerName === customerName);
            const history = document.getElementById('ordersHistory');
            if (customerOrders.length === 0) return;
            let html = '';
            customerOrders.forEach(o => {
                html += `<div class="order-card"><strong>Ø·Ù„Ø¨ #${o.id}</strong> - ${o.status}<p>${o.items.map(i => i.name).join(', ')}</p></div>`;
            });
            history.innerHTML = html;
        }
    </script>
</body>
</html>
