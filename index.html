<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª - ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <script>
        if (!localStorage.getItem('currentCustomer')) { window.location.href = 'auth/login.html'; }
    </script>

    <div id="orderSection" class="main-container">
        <header class="customer-header">
            <h1>â˜• Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h1>
            <div class="user-info">
                <span id="userNameDisplay"></span>
                <button onclick="customerLogout()" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div class="container">
            <div class="orders-layout">
                <div class="products-section">
                    <h2>ğŸ“‹ Ø§Ø®ØªØ± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª</h2>
                    <div style="margin-bottom:10px;">
                        <button onclick="addAllProductsToOrder()" class="add-all-btn">Ø¥Ø¶Ø§ÙØ© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù„Ù„Ø·Ù„Ø¨</button>
                    </div>
                    <div class="product-grid" id="productGrid"></div>
                </div>

                <div class="order-summary">
                    <h2>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</h2>
                    <div id="orderItems" class="order-items"><p style="color: #999;">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ø¹Ù†Ø§ØµØ±</p></div>
                    <div class="order-notes">
                        <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</label>
                        <textarea id="orderNotes" placeholder="Ø§ÙƒØªØ¨ Ù…Ù„Ø§Ø­Ø¸ØªÙƒ Ù‡Ù†Ø§..." rows="3" style="width:100%;"></textarea>
                    </div>
                    <div class="order-total"><h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù†Ø§ØµØ±: <span id="totalPrice">0</span></h3></div>
                    <button onclick="submitOrder()" class="submit-btn">âœ“ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</button>
                    <button onclick="clearOrder()" class="clear-btn">âœ• Ù…Ø³Ø­ Ø§Ù„Ø·Ù„Ø¨</button>
                </div>
            </div>

            <div class="orders-tracking">
                <h2>ğŸ“¦ ØªØªØ¨Ø¹ Ø·Ù„Ø¨Ø§ØªÙƒ</h2>
                <div id="ordersHistory" class="orders-history"></div>
            </div>
        </div>
    </div>

    <script>
        const products = ['Ø´Ø§ÙŠ', 'Ø´Ø§ÙŠ Ø£Ø®Ø¶Ø±', 'ÙŠØ§Ù†Ø³ÙˆÙ†', 'Ù†Ø¹Ù†Ø§Ø¹', 'ÙƒØ±ÙƒØ¯ÙŠØ©', 'Ù‚Ø±ÙØ©', 'Ø¬Ù†Ø²Ø¨ÙŠÙ„', 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³', 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1', 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§', 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡', 'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª', 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ', 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ', 'Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨', 'Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨'];
        let currentOrder = [];

        function renderProducts() {
            const grid = document.getElementById('productGrid');
            const inv = JSON.parse(localStorage.getItem('inventory')) || {};
            grid.innerHTML = '';
            products.forEach((name, idx) => {
                const stock = inv[name] ? inv[name].stock : 50;
                grid.innerHTML += `
                    <div class="card ${stock <= 0 ? 'out-of-stock' : ''}">
                        <h3>${name}</h3>
                        <div class="quantity-selector">
                            <button onclick="changeQty(${idx}, -1)">-</button>
                            <input type="number" id="qty${idx}" value="0" readonly>
                            <button onclick="changeQty(${idx}, 1)">+</button>
                        </div>
                        <button onclick="addToOrder(${idx}, '${name}')" class="add-btn" ${stock <= 0 ? 'disabled' : ''}>Ø¥Ø¶Ø§ÙØ©</button>
                    </div>`;
            });
        }

        function changeQty(idx, amt) {
            const input = document.getElementById('qty' + idx);
            input.value = Math.max(0, parseInt(input.value) + amt);
        }

        function addToOrder(idx, name) {
            const qty = parseInt(document.getElementById('qty' + idx).value);
            if (qty <= 0) return;
            const existing = currentOrder.find(i => i.name === name);
            if (existing) existing.qty += qty; else currentOrder.push({ name, qty });
            document.getElementById('qty' + idx).value = 0;
            updateOrderDisplay();
        }

        function updateOrderDisplay() {
            const container = document.getElementById('orderItems');
            let total = 0;
            if (currentOrder.length === 0) {
                container.innerHTML = '<p style="color: #999;">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>';
                document.getElementById('totalPrice').textContent = '0';
                return;
            }
            container.innerHTML = currentOrder.map((item, idx) => {
                total += item.qty;
                return `<div class="order-item"><span>${item.name} (${item.qty})</span><button onclick="removeFromOrder(${idx})" class="remove-btn">âœ•</button></div>`;
            }).join('');
            document.getElementById('totalPrice').textContent = total;
        }

        function removeFromOrder(idx) { currentOrder.splice(idx, 1); updateOrderDisplay(); }

        function submitOrder() {
            if (currentOrder.length === 0) return;
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.push({
                id: Date.now(),
                customerName: localStorage.getItem('currentCustomer'),
                items: currentOrder,
                date: new Date().toLocaleString('ar-EG'),
                status: 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©',
                notes: document.getElementById('orderNotes').value
            });
            localStorage.setItem('orders', JSON.stringify(orders));
            alert('ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!');
            clearOrder();
            loadCustomerOrders();
        }

        function clearOrder() { currentOrder = []; document.getElementById('orderNotes').value = ''; updateOrderDisplay(); }

        function loadCustomerOrders() {
            const name = localStorage.getItem('currentCustomer');
            const orders = (JSON.parse(localStorage.getItem('orders')) || []).filter(o => o.customerName === name);
            document.getElementById('ordersHistory').innerHTML = orders.reverse().map(o => `
                <div class="order-card ${o.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' ? 'approved' : ''}">
                    <strong>Ø·Ù„Ø¨ #${o.id.toString().slice(-4)}</strong> - ${o.status}
                    <p>${o.items.map(i => i.name + ' (' + i.qty + ')').join(', ')}</p>
                </div>`).join('');
        }

        function customerLogout() { localStorage.removeItem('currentCustomer'); window.location.href = 'auth/login.html'; }

        window.onload = () => {
            document.getElementById('userNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${localStorage.getItem('currentCustomer')}`;
            renderProducts();
            loadCustomerOrders();
            setInterval(loadCustomerOrders, 5000);
        };
    </script>
</body>
</html>