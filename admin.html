<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª - Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ù…Ù†</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div id="adminSection" class="main-container">
        <header class="admin-header">
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ù…Ù†</h1>
            <div class="user-info">
                <span id="adminNameDisplay"></span>
                <button onclick="adminLogout()" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div class="container">
            <div class="tabs">
                <button onclick="switchTab('orders')" class="tab-btn active">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button onclick="switchTab('inventory')" class="tab-btn">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
                <button onclick="switchTab('reports')" class="tab-btn">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</button>
            </div>

            <div id="ordersTab" class="tab-content active">
                <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                <div id="ordersContainer" class="orders-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody"></tbody>
                    </table>
                    <p id="noOrders" style="text-align: center; color: #999; margin-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            </div>

            <div id="inventoryTab" class="tab-content">
                <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
                <div class="inventory-grid" id="inventoryGrid"></div>
            </div>

            <div id="reportsTab" class="tab-content">
                <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h2>
                <div class="reports-controls">
                    <button onclick="generateWeeklyReport()" class="report-btn">ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
                    <button onclick="downloadReport()" class="report-btn">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                </div>
                <div id="reportContent" class="report-content">
                    <p style="color: #999; text-align: center;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±" Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const adminUsers = { 'HITLER': { password: '1234', name: 'Ù‡ØªÙ„Ø± ' }, 'manager': { password: '5678', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª' } };
        const defaultInventory = { 'Ø´Ø§ÙŠ': { key: 'p0', stock: 50, price: 15 }, 'Ø´Ø§ÙŠ Ø§Ø®Ø¶': { key: 'p1', stock: 50, price: 15 }, 'ÙŠØ§Ù†Ø³ÙˆÙ†': { key: 'p2', stock: 50, price: 15 }, 'Ù†Ø¹Ù†Ø§Ø¹': { key: 'p3', stock: 50, price: 15 }, 'ÙƒØ±ÙƒØ¯ÙŠØ©': { key: 'p4', stock: 50, price: 15 }, 'Ù‚Ø±ÙØ©': { key: 'p5', stock: 50, price: 15 }, 'Ø¬Ù†Ø²Ø¨ÙŠÙ„': { key: 'p6', stock: 50, price: 15 }, 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³': { key: 'p7', stock: 50, price: 15 }, 'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1': { key: 'p8', stock: 50, price: 15 }, 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1': { key: 'p9', stock: 50, price: 15 }, 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1': { key: 'p10', stock: 50, price: 15 }, 'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ': { key: 'p11', stock: 50, price: 15 }, 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚': { key: 'p12', stock: 50, price: 15 }, 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§': { key: 'p13', stock: 50, price: 15 }, 'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡': { key: 'p14', stock: 50, price: 15 }, 'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª': { key: 'p15', stock: 50, price: 15 }, 'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ': { key: 'p16', stock: 50, price: 15 }, 'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ': { key: 'p17', stock: 50, price: 15 }, 'Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨': { key: 'p18', stock: 50, price: 15 }, 'Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨': { key: 'p19', stock: 50, price: 15 } };
        let inventory = {};

        window.addEventListener('load', function() {
            const admin = localStorage.getItem('adminUser');
            if (!admin || !adminUsers[admin]) { window.location.href = "login.html"; }
            else {
                document.getElementById('adminNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${adminUsers[admin].name}`;
                loadInventory(); loadOrders();
            }
        });

        function adminLogout() { localStorage.removeItem('adminUser'); window.location.href = "login.html"; }

        function loadInventory() {
            const savedRaw = localStorage.getItem('inventory');
            inventory = Object.assign({}, defaultInventory);
            if (savedRaw) {
                let saved = JSON.parse(savedRaw);
                for (let n in saved) inventory[n] = saved[n];
            }
            renderInventoryGrid();
        }

        function renderInventoryGrid() {
            const grid = document.getElementById('inventoryGrid');
            grid.innerHTML = '';
            for (const [name, data] of Object.entries(inventory)) {
                grid.innerHTML += `<div class="inventory-card"><h3>${name}</h3><p>Ø§Ù„Ø³Ø¹Ø±: ${data.price}</p><div class="inventory-info"><div class="quantity-input"><button onclick="changeInv('${data.key}',-1)">-</button><input type="number" id="stock-${data.key}" value="${data.stock}"><button onclick="changeInv('${data.key}',1)">+</button></div><button onclick="saveInv('${data.key}')" class="save-btn">ğŸ’¾ Ø­ÙØ¸</button></div></div>`;
            }
        }

        function changeInv(key, val) { let inp = document.getElementById('stock-'+key); inp.value = Math.max(0, parseInt(inp.value) + val); }
        function saveInv(key) { 
            for(let n in inventory) if(inventory[n].key === key) inventory[n].stock = parseInt(document.getElementById('stock-'+key).value);
            localStorage.setItem('inventory', JSON.stringify(inventory)); alert('ØªÙ… Ø§Ù„Ø­ÙØ¸');
        }

        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const tbody = document.getElementById('ordersTableBody');
            tbody.innerHTML = '';
            if (orders.length === 0) { document.getElementById('noOrders').style.display = 'block'; return; }
            document.getElementById('noOrders').style.display = 'none';
            orders.forEach((o, i) => {
                const statusClass = o.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' ? 'approved' : 'pending';
                tbody.innerHTML += `<tr><td>${i+1}</td><td>${o.customerName}</td><td>${o.items.map(it=>`${it.name} (${it.qty})`).join(', ')}</td><td>${o.notes||'-'}</td><td>${o.date}</td><td>${o.adminRecipient||'-'}</td><td><span class="status ${statusClass}">${o.status}</span></td><td class="actions">${o.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ? `<button onclick="approveOrder(${i})" class="approve-btn">âœ“</button><button onclick="rejectOrder(${i})" class="reject-btn">âœ•</button>` : `<button onclick="alert('Ø·Ù„Ø¨ Ù…ÙƒØªÙ…Ù„')" class="view-btn">ğŸ‘ï¸</button>`}</td></tr>`;
            });
        }

        function approveOrder(i) {
            let orders = JSON.parse(localStorage.getItem('orders'));
            let admin = localStorage.getItem('adminUser');
            orders[i].items.forEach(it => { if(inventory[it.name]) inventory[it.name].stock -= it.qty; });
            orders[i].status = 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡';
            orders[i].adminRecipient = adminUsers[admin].name;
            localStorage.setItem('orders', JSON.stringify(orders));
            localStorage.setItem('inventory', JSON.stringify(inventory));
            loadOrders(); renderInventoryGrid();
        }

        function rejectOrder(i) {
            let orders = JSON.parse(localStorage.getItem('orders'));
            orders.splice(i, 1);
            localStorage.setItem('orders', JSON.stringify(orders));
            loadOrders();
        }

        // --- Ø§Ø³ØªØ¹Ø§Ø¯Ø© ÙƒÙˆØ¯ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„ØªÙØµÙŠÙ„ÙŠ Ø§Ù„Ø£ØµÙ„ÙŠ ---
        function generateWeeklyReport() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const approvedOrders = orders.filter(o => o.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡');
            if (approvedOrders.length === 0) { document.getElementById('reportContent').innerHTML = '<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</p>'; return; }

            const customerOrders = {};
            approvedOrders.forEach(order => {
                if (!customerOrders[order.customerName]) customerOrders[order.customerName] = [];
                customerOrders[order.customerName].push(order);
            });

            let reportHTML = `<div class="report-header"><h3>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø§Ù„ØªÙØµÙŠÙ„ÙŠ</h3><p>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: ${new Date().toLocaleDateString('ar-EG')}</p></div>`;
            
            for (const [name, orders] of Object.entries(customerOrders)) {
                reportHTML += `<div class="customer-report"><h5>ğŸ‘¤ Ø§Ù„Ø¹Ù…ÙŠÙ„: ${name}</h5><table class="admin-table"><thead><tr><th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th><th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr></thead><tbody>`;
                orders.forEach(o => {
                    reportHTML += `<tr><td>#${o.id}</td><td>${o.date}</td><td>${o.items.map(it=>`${it.name} (${it.qty})`).join(', ')}</td><td>${o.adminRecipient}</td><td>${o.notes || '-'}</td></tr>`;
                });
                reportHTML += `</tbody></table></div>`;
            }
            document.getElementById('reportContent').innerHTML = reportHTML;
        }

        function downloadReport() {
            const content = document.getElementById('reportContent').innerText;
            const blob = new Blob([content], {type: 'text/plain'});
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            a.download = 'ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª.txt';
            a.click();
        }

        function switchTab(t) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(t+'Tab').classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
