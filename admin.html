<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¨Ø§Øª - Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ù…Ù†</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¥Ø¯Ù…Ù† -->
    <div id="adminLoginSection" class="auth-container">
        <div class="auth-box">
            <h2>ğŸ” ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø¥Ø¯Ù…Ù†</h2>
            <div class="form-group">
                <label>Ø§Ø³Ù… Ø§Ù„Ø¥Ø¯Ù…Ù†:</label>
                <input type="text" id="adminUsername" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¥Ø¯Ù…Ù†">
            </div>
            <div class="form-group">
                <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                <input type="password" id="adminPassword" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
            </div>
            <button onclick="adminLogin()" class="auth-btn">Ø¯Ø®ÙˆÙ„</button>
            <p style="color: #999; font-size: 12px; margin-top: 10px;">
                Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©: Ø§Ù„Ø§Ø³Ù…: admin | Ø§Ù„Ø±Ù…Ø²: 1234
            </p>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ù…Ù† -->
    <div id="adminSection" class="main-container" style="display: none;">
        <header class="admin-header">
            <h1>ğŸ“Š Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø¥Ø¯Ù…Ù†</h1>
            <div class="user-info">
                <span id="adminNameDisplay"></span>
                <button onclick="adminLogout()" class="logout-btn">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
            </div>
        </header>

        <div class="container">
            <!-- Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨ -->
            <div class="tabs">
                <button onclick="switchTab('orders')" class="tab-btn active">ğŸ“‹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>
                <button onclick="switchTab('inventory')" class="tab-btn">ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</button>
                <button onclick="switchTab('reports')" class="tab-btn">ğŸ“ˆ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</button>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
            <div id="ordersTab" class="tab-content active">
                <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
                <div id="ordersContainer" class="orders-table-container">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>#</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</th>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                <th>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                                <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…</th>
                                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                                <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                            </tr>
                        </thead>
                        <tbody id="ordersTableBody">
                        </tbody>
                    </table>
                    <p id="noOrders" style="text-align: center; color: #999; margin-top: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø­Ø§Ù„ÙŠØ§Ù‹</p>
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† -->
            <div id="inventoryTab" class="tab-content">
                <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†</h2>
                <div class="inventory-grid" id="inventoryGrid">
                    <!-- Ø³ÙŠÙØ¹Ø±Ø¶ Ù‡Ù†Ø§ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ -->
                </div>
            </div>

            <!-- Ù‚Ø³Ù… Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <div id="reportsTab" class="tab-content">
                <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©</h2>
                <div class="reports-controls">
                    <button onclick="generateWeeklyReport()" class="report-btn">ğŸ“Š Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ± Ù‡Ø°Ø§ Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</button>
                    <button onclick="downloadReport()" class="report-btn">ğŸ’¾ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
                </div>
                <div id="reportContent" class="report-content">
                    <p style="color: #999; text-align: center;">Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø¥Ù†Ø´Ø§Ø¡ ØªÙ‚Ø±ÙŠØ±" Ù„Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¥Ø¯Ù…Ù†
        const adminUsers = {
            'HITLER': { password: '1234', name: 'Ù‡ØªÙ„Ø± ' },
            'manager': { password: '5678', name: 'Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª' }
        };

        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ø£ÙˆÙ„ÙŠØ© (Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©)
        const defaultInventory = {
            'Ø´Ø§ÙŠ': { key: 'p0', stock: 50, price: 15 },
            'Ø´Ø§ÙŠ Ø§Ø®Ø¶': { key: 'p1', stock: 50, price: 15 },
            'ÙŠØ§Ù†Ø³ÙˆÙ†': { key: 'p2', stock: 50, price: 15 },
            'Ù†Ø¹Ù†Ø§Ø¹': { key: 'p3', stock: 50, price: 15 },
            'ÙƒØ±ÙƒØ¯ÙŠØ©': { key: 'p4', stock: 50, price: 15 },
            'Ù‚Ø±ÙØ©': { key: 'p5', stock: 50, price: 15 },
            'Ø¬Ù†Ø²Ø¨ÙŠÙ„': { key: 'p6', stock: 50, price: 15 },
            'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³': { key: 'p7', stock: 50, price: 15 },
            'ÙƒÙˆÙÙŠ Ù…ÙŠÙƒØ³ 4*1': { key: 'p8', stock: 50, price: 15 },
            'Ù†Ø³ÙƒØ§ÙÙŠÙ‡3*1': { key: 'p9', stock: 50, price: 15 },
            'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ 2*1': { key: 'p10', stock: 50, price: 15 },
            'Ù†Ø³ÙƒØ§ÙÙŠÙ‡ Ø¨Ù„Ø§Ùƒ': { key: 'p11', stock: 50, price: 15 },
            'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ø¨Ù†Ø¯Ù‚': { key: 'p12', stock: 50, price: 15 },
            'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù…ÙˆÙƒØ§': { key: 'p13', stock: 50, price: 15 },
            'ÙƒØ§Ø¨ØªØ´ÙŠÙ†Ùˆ Ù„Ø§ØªÙŠÙ‡': { key: 'p14', stock: 50, price: 15 },
            'Ù‡ÙˆØª Ø´ÙˆÙƒÙ„Øª': { key: 'p15', stock: 50, price: 15 },
            'Ù‚Ù‡ÙˆØ© ØªØ±ÙƒÙŠ': { key: 'p16', stock: 50, price: 15 },
            'Ù‚Ù‡ÙˆØ© ÙØ±Ù†Ø³Ø§ÙˆÙŠ': { key: 'p17', stock: 50, price: 15 },
            'Ù‚Ø±ÙØ© Ø¨Ø­Ù„ÙŠØ¨': { key: 'p18', stock: 50, price: 15 },
            'Ø´Ø§ÙŠ Ø¨Ø­Ù„ÙŠØ¨': { key: 'p19', stock: 50, price: 15 }
        };

        // Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©: Ù†Ø£Ø®Ø° Ù†Ø³Ø®Ø© Ù…Ù† Ø§Ù„Ø§ÙØªØ±Ø§Ø¶Ø§Øª
        let inventory = Object.assign({}, defaultInventory);

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙˆØ¯Ù…Ø¬Ù‡Ø§ Ù…Ø¹ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶Ø§Øª Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙÙ‚ÙˆØ¯Ø©
        function loadInventory() {
            const savedRaw = localStorage.getItem('inventory');
            let saved = {};
            try {
                if (savedRaw) saved = JSON.parse(savedRaw) || {};
            } catch (e) {
                saved = {};
            }

            // Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø§ÙØªØ±Ø§Ø¶Ø§Øª Ø«Ù… Ø¶Ø¹ Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø© ÙÙˆÙ‚Ù‡Ø§ (ØªØ­Ø§ÙØ¸ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ù…ÙÙ‚ÙˆØ¯Ø© Ù…Ù† Ø§Ù„Ø³Ø§Ø¨Ù‚)
            inventory = Object.assign({}, defaultInventory);
            for (const [name, data] of Object.entries(saved)) {
                inventory[name] = data;
            }

            // Ø­ÙØ¸ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø¯Ù…Ø¬Ø© Ù„ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
            localStorage.setItem('inventory', JSON.stringify(inventory));

            renderInventoryGrid();
            updateInventoryDisplay();
        }

        // Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¹Ø±Ø¶ Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ ÙƒØ§Ø¦Ù† inventory
        function renderInventoryGrid() {
            const grid = document.getElementById('inventoryGrid');
            if (!grid) return;
            grid.innerHTML = '';
            for (const [name, data] of Object.entries(inventory)) {
                const card = document.createElement('div');
                card.className = 'inventory-card';
                card.innerHTML = `
                    <h3>${name}</h3>
                    <p>Ø§Ù„Ø³Ø¹Ø±: <strong>${data.price}</strong> Ø¬Ù†ÙŠØ©</p>
                    <div class="inventory-info">
                        <label>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…ØªÙˆÙØ±Ø©:</label>
                        <div class="quantity-input">
                            <button onclick="decreaseInventory('${data.key}')">-</button>
                            <input type="number" id="stock-${data.key}" value="${data.stock}" min="0">
                            <button onclick="increaseInventory('${data.key}')">+</button>
                        </div>
                        <button onclick="saveInventory('${data.key}')" class="save-btn">ğŸ’¾ Ø­ÙØ¸</button>
                    </div>
                `;
                grid.appendChild(card);
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        function updateInventoryDisplay() {
            for (const [name, data] of Object.entries(inventory)) {
                const input = document.getElementById('stock-' + data.key);
                if (input) {
                    input.value = data.stock;
                }
            }
        }

        // Ø¯ÙˆØ§Ù„ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function adminLogin() {
            const username = document.getElementById('adminUsername').value.trim();
            const password = document.getElementById('adminPassword').value;

            if (!username || !password) {
                alert('ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }

            if (adminUsers[username] && adminUsers[username].password === password) {
                localStorage.setItem('adminUser', username);
                document.getElementById('adminLoginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('adminNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${adminUsers[username].name}`;
                loadOrders();
                loadInventory();
            } else {
                alert('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø©');
            }
        }

        function adminLogout() {
            localStorage.removeItem('adminUser');
            document.getElementById('adminLoginSection').style.display = 'block';
            document.getElementById('adminSection').style.display = 'none';
            document.getElementById('adminUsername').value = '';
            document.getElementById('adminPassword').value = '';
        }

        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function switchTab(tabName) {
            // Ø¥Ø®ÙØ§Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            // Ø¥Ø¸Ù‡Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ù…Ø®ØªØ§Ø±
            document.getElementById(tabName + 'Tab').classList.add('active');
            event.target.classList.add('active');
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
        function loadOrders() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const tbody = document.getElementById('ordersTableBody');
            const noOrders = document.getElementById('noOrders');

            tbody.innerHTML = '';

            if (orders.length === 0) {
                noOrders.style.display = 'block';
                return;
            }

            noOrders.style.display = 'none';

            orders.forEach((order, index) => {
                const items = order.items.map(item => `${item.name} (${item.qty})`).join(', ');
                const statusClass = order.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡' ? 'approved' : 'pending';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${order.customerName}</td>
                    <td>${items}</td>
                    <td>${order.notes ? order.notes : '-'}</td>
                    <td>${order.date}</td>
                    <td>${order.adminRecipient || '-'}</td>
                    <td><span class="status ${statusClass}">${order.status}</span></td>
                    <td class="actions">
                        ${order.status === 'Ù‚ÙŠØ¯ Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø©' ? `
                            <button onclick="approveOrderModal(${index})" class="approve-btn">âœ“ Ù…ÙˆØ§ÙÙ‚Ø©</button>
                            <button onclick="rejectOrder(${index})" class="reject-btn">âœ• Ø±ÙØ¶</button>
                        ` : `
                            <button onclick="viewOrder(${index})" class="view-btn">ğŸ‘ï¸ Ø¹Ø±Ø¶</button>
                        `}
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        // ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªÙ„Ù…
        function approveOrderModal(index) {
            const adminName = localStorage.getItem('adminUser');
            if (!adminName) {
                alert('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¬Ù„Ø³Ø©');
                return;
            }

            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders[index];

            const adminFullName = adminUsers[adminName] ? adminUsers[adminName].name : adminName;

            // Ø®ØµÙ… Ø§Ù„ÙƒÙ…ÙŠØ§Øª Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ù…Ø­ØªÙˆÙŠØ§Øª Ø§Ù„Ø·Ù„Ø¨
            try {
                for (const item of order.items) {
                    if (inventory && inventory[item.name]) {
                        // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø®Ø§ØµÙŠØ© stock
                        const current = parseInt(inventory[item.name].stock) || 0;
                        const newStock = Math.max(0, current - item.qty);
                        inventory[item.name].stock = newStock;
                    }
                }
                // Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø²ÙˆÙ† Ø§Ù„Ù…Ø­Ø¯Ø«
                localStorage.setItem('inventory', JSON.stringify(inventory));
            } catch (e) {
                console.error('Ø®Ø·Ø£ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø®Ø²ÙˆÙ†:', e);
            }

            orders[index].status = 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡';
            orders[index].adminRecipient = adminFullName;
            localStorage.setItem('orders', JSON.stringify(orders));

            // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ† ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª
            try { updateInventoryDisplay(); } catch (e) {}
            loadOrders();
            alert('âœ“ ØªÙ… Ø§Ù„Ù…ÙˆØ§ÙÙ‚Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø·Ù„Ø¨ Ù…Ù† Ù‚Ø¨Ù„: ' + adminFullName);
        }

        // Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨
        function rejectOrder(index) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            orders.splice(index, 1);
            localStorage.setItem('orders', JSON.stringify(orders));
            loadOrders();
            alert('âœ• ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø·Ù„Ø¨');
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨
        function viewOrder(index) {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const order = orders[index];
            const items = order.items.map(item => `${item.name}: ${item.qty}`).join('\n');
            let details = `ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨:\n\nØ§Ù„Ø¹Ù…ÙŠÙ„: ${order.customerName}\n\nØ§Ù„Ù…Ù†ØªØ¬Ø§Øª:\n${items}`;
            if (order.notes) {
                details += `\n\nÙ…Ù„Ø§Ø­Ø¸Ø§Øª:\n${order.notes}`;
            }
            
            if (order.adminRecipient) {
                details += `\n\nØªÙ… Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù… Ø¨ÙˆØ§Ø³Ø·Ø©: ${order.adminRecipient}`;
            }
            
            alert(details);
        }

        // Ø¯ÙˆØ§Ù„ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø®Ø²ÙˆÙ†
        function increaseInventory(key) {
            const input = document.getElementById('stock-' + key);
            input.value = parseInt(input.value) + 1;
        }

        function decreaseInventory(key) {
            const input = document.getElementById('stock-' + key);
            if (parseInt(input.value) > 0) {
                input.value = parseInt(input.value) - 1;
            }
        }

        function saveInventory(key) {
            const input = document.getElementById('stock-' + key);
            const newStock = parseInt(input.value);

            for (const [name, data] of Object.entries(inventory)) {
                if (data.key === key) {
                    data.stock = newStock;
                    break;
                }
            }

            localStorage.setItem('inventory', JSON.stringify(inventory));
            alert('âœ“ ØªÙ… Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø²ÙˆÙ†');
        }

        // Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©
        function generateWeeklyReport() {
            const orders = JSON.parse(localStorage.getItem('orders')) || [];
            const approvedOrders = orders.filter(o => o.status === 'Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡');

            if (approvedOrders.length === 0) {
                document.getElementById('reportContent').innerHTML = '<p style="text-align: center; color: #999;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…ÙˆØ§ÙÙ‚ Ø¹Ù„ÙŠÙ‡Ø§</p>';
                return;
            }

            // Ø­Ø³Ø§Ø¨ Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
            const productTotals = {};

            approvedOrders.forEach(order => {
                order.items.forEach(item => {
                    if (!productTotals[item.name]) {
                        productTotals[item.name] = 0;
                    }
                    productTotals[item.name] += item.qty;
                });
            });

            // Ø¨Ù†Ø§Ø¡ Ø§Ù„ØªÙ‚Ø±ÙŠØ±
            let reportHTML = `
                <div class="report-header">
                    <h3>ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠ Ø§Ù„Ù…ÙØµÙ„</h3>
                    <p>Ø§Ù„ØªØ§Ø±ÙŠØ®: ${new Date().toLocaleDateString('ar-EG')}</p>
                </div>
                <div class="report-summary">
                    <div class="summary-item">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª:</span>
                        <strong>${approvedOrders.length}</strong>
                    </div>
                    <div class="summary-item">
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡:</span>
                        <strong>${[...new Set(approvedOrders.map(o => o.customerName))].length}</strong>
                    </div>
                </div>

                <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div class="report-section">
                    <h4>ğŸ“¦ Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</h4>
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Ø§Ù„Ù…Ù†ØªØ¬</th>
                                <th>Ø§Ù„ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø¨Ø§Ø¹Ø©</th>
                            </tr>
                        </thead>
                        <tbody>
            `;

            for (const [product, qty] of Object.entries(productTotals)) {
                reportHTML += `
                    <tr>
                        <td>${product}</td>
                        <td>${qty}</td>
                    </tr>
                `;
            }

            reportHTML += `
                        </tbody>
                    </table>
                </div>

                <!-- ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø§Ù„Ù…ÙØµÙ„ -->
                <div class="report-section">
                    <h4>ğŸ‘¥ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„</h4>
            `;

            // ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…ÙŠÙ„
            const customerOrders = {};
            approvedOrders.forEach(order => {
                if (!customerOrders[order.customerName]) {
                    customerOrders[order.customerName] = [];
                }
                customerOrders[order.customerName].push(order);
            });

            // Ø¹Ø±Ø¶ ØªÙØ§ØµÙŠÙ„ ÙƒÙ„ Ø¹Ù…ÙŠÙ„
            for (const [customerName, orders] of Object.entries(customerOrders)) {
                let customerTotal = orders.reduce((sum, order) => sum + order.total, 0);
                
                reportHTML += `
                    <div class="customer-report">
                        <div class="customer-header">
                            <h5>ğŸ‘¤ ${customerName}</h5>
                            <span class="customer-total">Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø¨Ø§Øª: ${orders.length}</span>
                        </div>
                        <table class="customer-table">
                            <thead>
                                <tr>
                                    <th>Ø±Ù‚Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                                    <th>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</th>
                                    <th>Ù…Ø³ØªÙ„Ù… Ø§Ù„Ø·Ù„Ø¨</th>
                                </tr>
                            </thead>
                            <tbody>
                `;
                
                orders.forEach(order => {
                    const items = order.items.map(item => `${item.name} (${item.qty})`).join(', ');
                    reportHTML += `
                        <tr>
                            <td>#${order.id}</td>
                            <td>${order.date}</td>
                            <td>${items}</td>
                            <td>${order.adminRecipient || '-'}</td>
                        </tr>
                    `;
                });
                
                reportHTML += `
                            </tbody>
                        </table>
                    </div>
                `;
            }

            reportHTML += `
                </div>
            `;

            document.getElementById('reportContent').innerHTML = reportHTML;
        }

        function downloadReport() {
            const reportContent = document.getElementById('reportContent').innerText;
            if (reportContent.includes('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª')) {
                alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ ØªÙ‚Ø±ÙŠØ± Ù„Ù„ØªØ­Ù…ÙŠÙ„');
                return;
            }

            const element = document.createElement('a');
            element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(reportContent));
            element.setAttribute('download', `ØªÙ‚Ø±ÙŠØ±_Ø£Ø³Ø¨ÙˆØ¹ÙŠ_${new Date().toLocaleDateString('ar-EG')}.txt`);
            element.style.display = 'none';
            document.body.appendChild(element);
            element.click();
            document.body.removeChild(element);
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¬Ù„Ø³Ø© Ø§Ù„Ø¥Ø¯Ù…Ù†
        window.addEventListener('load', function() {
            const admin = localStorage.getItem('adminUser');
            if (admin && adminUsers[admin]) {
                document.getElementById('adminLoginSection').style.display = 'none';
                document.getElementById('adminSection').style.display = 'block';
                document.getElementById('adminNameDisplay').textContent = `Ù…Ø±Ø­Ø¨Ø§Ù‹ØŒ ${adminUsers[admin].name}`;
                loadOrders();
                loadInventory();
            }
        });

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
        loadInventory();
    </script>
</body>
</html>